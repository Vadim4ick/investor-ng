<div class="my-16">
  <app-container>
    <div class="space-y-4">
      <ub-tabs
        [items]="tabItems()"
        [active]="activeTab()"
        (activeChange)="setActiveTab($event)"
      ></ub-tabs>

      @switch (activeTab()) {
        @case ('live') {
          <div class="mt-6 rounded-2xl p-6 bg-card border border-border">
            <div
              class="text-lg font-semibold mb-2"
              [innerHTML]="'simulator.tabs.live.title' | translate"
            ></div>
            <div
              class="text-sm text-gray"
              [innerHTML]="'simulator.tabs.live.desc' | translate"
            ></div>
          </div>
        }

        @case ('invest') {
          <div class="mt-6 rounded-2xl p-6 bg-card border border-border">
            <div
              class="text-lg font-semibold mb-2"
              [innerHTML]="'simulator.tabs.invest.title' | translate"
            ></div>
            <div
              class="text-sm text-gray"
              [innerHTML]="'simulator.tabs.invest.desc' | translate"
            ></div>
          </div>

          <!-- ДОП. НАСТРОЙКИ ИНВЕСТИРОВАНИЯ -->
          <div class="rounded-2xl p-6 bg-card border border-border space-y-6">
            <!-- Доходность -->
            <div class="flex flex-col gap-2">
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium">
                  {{ 'simulator.invest.return' | translate }}
                </label>
                <span class="font-semibold">{{ investReturn() }}%</span>
              </div>

              <div class="flex items-center gap-4">
                <div class="relative flex-1">
                  <div class="relative h-2 w-full rounded-full bg-gray-200 dark:bg-zinc-800">
                    <div
                      class="absolute h-2 rounded-full bg-green-500"
                      [style.width.%]="investReturnPercent()"
                    ></div>
                  </div>

                  <input
                    type="range"
                    min="0"
                    max="30"
                    [ngModel]="investReturn()"
                    (ngModelChange)="setInvestReturn($event)"
                    class="absolute top-0 left-0 w-full h-2 appearance-none bg-transparent cursor-pointer"
                  />
                </div>
              </div>
            </div>

            <!-- Реинвест -->
            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium">
                {{ 'simulator.invest.reinvest' | translate }}
              </label>

              <div class="flex flex-col sm:flex-row gap-3">
                <label
                  class="flex items-center gap-2 rounded-xl border border-border bg-background px-4 py-3 cursor-pointer"
                >
                  <input
                    type="radio"
                    name="reinvestMode"
                    [checked]="reinvestMode() === 'reinvest'"
                    (change)="setReinvestMode('reinvest')"
                  />
                  <span class="text-sm">{{ 'simulator.invest.reinvest_yes' | translate }}</span>
                </label>

                <label
                  class="flex items-center gap-2 rounded-xl border border-border bg-background px-4 py-3 cursor-pointer"
                >
                  <input
                    type="radio"
                    name="reinvestMode"
                    [checked]="reinvestMode() === 'payout'"
                    (change)="setReinvestMode('payout')"
                  />
                  <span class="text-sm">{{ 'simulator.invest.reinvest_no' | translate }}</span>
                </label>
              </div>
            </div>
          </div>
        }
      }

      <div class="grid md:grid-cols-[1.5fr_1fr_1fr] gap-6 items-start">
        <div class="flex items-center gap-4">
          <!-- ЗП -->
          <div class="flex flex-col gap-2">
            <label
              class="whitespace-nowrap"
              [innerHTML]="'simulator.sectionsGenerate.zp' | translate"
            ></label>

            <!-- ВАЖНО: signal нельзя биндинговать через [(ngModel)] напрямую -->
            <input
              ubInput
              ubMoneyInput
              type="text"
              [ngModel]="salary()"
              (ngModelChange)="salary.set($event)"
            />
          </div>

          <!-- Годы -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium whitespace-nowrap"
              [innerHTML]="'simulator.sectionsGenerate.years' | translate"
            ></label>

            <input
              type="text"
              ubInput
              ubMoneyInput
              [min]="1"
              [max]="99"
              [ngModel]="years()"
              (ngModelChange)="setYears($event)"
            />
          </div>

          <!-- Инфляция -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium whitespace-nowrap"
              [innerHTML]="'simulator.sectionsGenerate.inflation' | translate"
            ></label>

            <input
              type="text"
              ubInput
              ubMoneyInput
              [min]="1"
              [max]="50"
              [ngModel]="inflation()"
              (ngModelChange)="setInflation($event)"
            />
          </div>
        </div>

        <!-- Рост ЗП -->
        <div class="flex flex-col gap-2 md:col-span-1">
          <label
            class="text-sm font-medium"
            [innerHTML]="'simulator.sectionsGenerate.height' | translate"
          ></label>

          <div class="flex items-center gap-4">
            <div class="relative flex-1">
              <div class="relative h-2 w-full rounded-full bg-gray-200 dark:bg-zinc-800">
                <div
                  class="absolute h-2 rounded-full bg-green-500"
                  [style.width.%]="salaryGrowthPercent()"
                ></div>
              </div>

              <input
                type="range"
                min="0"
                max="20"
                [(ngModel)]="salaryGrowth"
                class="absolute top-0 left-0 w-full h-2 appearance-none bg-transparent cursor-pointer"
              />
            </div>

            <span class="text-right font-semibold"> {{ salaryGrowth }}% </span>
          </div>
        </div>

        <!-- Траты -->
        <div class="flex flex-col gap-2 md:col-span-1">
          <label
            class="text-sm font-medium"
            [innerHTML]="'simulator.sectionsGenerate.spending' | translate"
          >
          </label>

          <div class="flex items-center gap-4">
            <div class="relative flex-1">
              <div class="relative h-2 w-full rounded-full bg-gray-200 dark:bg-zinc-800">
                <div
                  class="absolute h-2 rounded-full bg-green-500"
                  [style.width.%]="spendPercentPercent()"
                ></div>
              </div>

              <input
                type="range"
                min="10"
                max="100"
                [(ngModel)]="spendPercent"
                class="absolute top-0 left-0 w-full h-2 appearance-none bg-transparent cursor-pointer"
              />
            </div>

            <span class="text-right font-semibold"> {{ spendPercent }}% </span>
          </div>
        </div>
      </div>

      <!-- Кнопка -->
      <button ubButton size="lg" (click)="runSimulation()">
        ПРОЖИТЬ {{ years() }} {{ yearsLabel() }}
      </button>

      @if (result(); as r) {
        <!-- РЕЗУЛЬТАТ -->
        <div @resultEnter class="mt-4 rounded-2xl p-6 bg-card border border-border">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
            <div>
              <div class="text-sm text-gray">Результат за {{ years() }} {{ yearsLabel() }}</div>
              <div class="text-3xl font-bold mt-2">Капитал: {{ r.capital | number }} ₽</div>
              <div class="text-gray mt-2">
                Финальная ЗП: <span class="font-semibold">{{ r.finalSalary | number }} ₽</span>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 w-full md:w-auto">
              <div class="rounded-xl bg-card p-4 border border-border">
                <div class="text-xs text-gray">Средн. накопления/мес</div>
                <div class="text-lg font-semibold mt-1">{{ r.avgInvestPerMonth | number }} ₽</div>
              </div>

              <div class="rounded-xl bg-card p-4 border border-border">
                <div class="text-xs text-gray">Средн. траты/мес</div>
                <div class="text-lg font-semibold mt-1">{{ r.avgSpendPerMonth | number }} ₽</div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </app-container>
</div>
